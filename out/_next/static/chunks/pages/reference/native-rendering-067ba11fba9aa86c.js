(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[484],{7875:function(e,n,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/reference/native-rendering",function(){return a(1570)}])},1570:function(e,n,a){"use strict";a.r(n),a.d(n,{__toc:function(){return c}});var i=a(5893),t=a(2673),s=a(3393),r=a(8426);a(9128);var o=a(2643);let c=[{depth:3,value:"Native Overlay",id:"native-overlay"},{depth:3,value:"Canvas Underlay",id:"canvas-underlay"},{depth:3,value:"Message-passing via FFI, C Structs",id:"message-passing-via-ffi-c-structs"},{depth:3,value:"Clipping & Occlusion",id:"clipping--occlusion"},{depth:3,value:"Accessibility & SEO",id:"accessibility--seo"},{depth:3,value:"Footprint",id:"footprint"}];function _createMdxContent(e){let n=Object.assign({h1:"h1",p:"p",em:"em",strong:"strong",h3:"h3",code:"code",a:"a"},(0,o.a)(),e.components);return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.h1,{children:"Native Rendering"}),"\n",(0,i.jsxs)(n.p,{children:["To render both ",(0,i.jsx)(n.em,{children:"native UI elements"})," and ",(0,i.jsx)(n.em,{children:"native 2D drawing"}),", every running Pax program renders to ",(0,i.jsx)(n.strong,{children:"two separate layers,"})," through different rendering contexts, composited with a unified coordinate space, clipping context, and event handling mechanism."]}),"\n",(0,i.jsx)(n.h3,{id:"native-overlay",children:"Native Overlay"}),"\n",(0,i.jsxs)(n.p,{children:["The top layer is the ",(0,i.jsx)(n.em,{children:"native overlay"})," — simply, a layer of OS-native elements, like SwiftUI ",(0,i.jsx)(n.code,{children:"Text"})," or ",(0,i.jsx)(n.code,{children:"Slider"})," elements on macOS/iOS, and ",(0,i.jsx)(n.code,{children:"<span>"})," or ",(0,i.jsx)(n.code,{children:"<button />"})," in browsers."]}),"\n",(0,i.jsxs)(n.p,{children:["Each native element is ",(0,i.jsx)(n.em,{children:"transformed"})," and ",(0,i.jsx)(n.em,{children:"clipped"})," in order to fit into the broader rendering context.  For example, if a ",(0,i.jsx)(n.code,{children:"Button"}),' is expected to be at the center of the screen, the Pax runtime knows how to transform, size, and clip that native element, to make it "float" in exactly the right place.']}),"\n",(0,i.jsx)(n.h3,{id:"canvas-underlay",children:"Canvas Underlay"}),"\n",(0,i.jsxs)(n.p,{children:["Underneath the native layer is a separate layer, where ",(0,i.jsx)(n.em,{children:"drawing"})," operations occur."]}),"\n",(0,i.jsxs)(n.p,{children:["Any of the drawing primitives like ",(0,i.jsx)(n.code,{children:"Rectangle"}),", ",(0,i.jsx)(n.code,{children:"Ellipse"}),", and ",(0,i.jsx)(n.code,{children:"Path"})," draw to this layer.  In the future, certain effects like drop shadows may draw to this layer as well.  "]}),"\n",(0,i.jsx)(n.h3,{id:"message-passing-via-ffi-c-structs",children:"Message-passing via FFI, C Structs"}),"\n",(0,i.jsxs)(n.p,{children:["Drawing to the canvas is straight-forward:  for a given operating system, Pax receives a pointer to a native canvas, as uses a polyfill (provided by the open source library ",(0,i.jsx)(n.a,{href:"https://www.github.com/linebender/piet",children:"Piet"}),") to turn a drawing operation like ",(0,i.jsx)(n.code,{children:"BezPath"})," into a operating-system native drawing call."]}),"\n",(0,i.jsx)(n.p,{children:"The result of this is that canvas drawing happens natively — for example, via CoreGraphics on macOS and iOS, Canvas2D in the browser, and Direct2D on Windows."}),"\n",(0,i.jsx)(n.p,{children:"How does Pax know how to draw native UI elements like Text?"}),"\n",(0,i.jsxs)(n.p,{children:["This is done through message-passing.  The Pax engine knows any time a native element is ",(0,i.jsx)(n.em,{children:"created"}),", has its properties ",(0,i.jsx)(n.em,{children:"updated"}),", or is ",(0,i.jsx)(n.em,{children:"deleted"})," (removed from render tree, e.g. via ",(0,i.jsx)(n.code,{children:"if"}),'.)  When any of these "CRUD" operations occur, the runtime sends a message to ',(0,i.jsxs)(n.a,{href:"./compilation-model",children:["the ",(0,i.jsx)(n.em,{children:"chassis"})]}),", and the chassis is responsible for interpreting that message and drawing the native elements that result."]}),"\n",(0,i.jsxs)(n.p,{children:["The messages are sent a C structs via a low-level bridge, using Rust's FFI functionality.  Serialization depends on the platform — for example, messages are passed as ",(0,i.jsx)(n.code,{children:"FlatBuffer"}),"s on macOS but ",(0,i.jsx)(n.code,{children:"JSON"})," in the browser (to avoid bloating ",(0,i.jsx)(n.code,{children:".wasm"})," footprint with a deserialization dependency.)"]}),"\n","\n",(0,i.jsx)(n.h3,{id:"clipping--occlusion",children:"Clipping & Occlusion"}),"\n",(0,i.jsxs)(n.p,{children:["When an element is clipped, for example by placing it into a ",(0,i.jsx)(n.code,{children:"Frame"})," element, each of the ",(0,i.jsx)(n.em,{children:"native overlay"})," and ",(0,i.jsx)(n.em,{children:"canvas underlay"})," layers are responsible for doing their own clipping, by separate mechanisms."]}),"\n",(0,i.jsxs)(n.p,{children:["The native layer clips using an OS-specific clipping mechanism, for example ",(0,i.jsx)(n.code,{children:".clipped()"})," on macOS and ",(0,i.jsx)(n.code,{children:"clip-path"})," on Web."]}),"\n",(0,i.jsx)(n.p,{children:"The canvas layer also uses an OS-specific clipping mechanism, but at the GPU/drawing level."}),"\n",(0,i.jsx)(n.p,{children:"Occlusion works by stacking native and canvas layers in the chassis. Based on the render tree's understanding of z-index, we create additional native & canvas layers to simulate occlusion."}),"\n",(0,i.jsx)(n.h3,{id:"accessibility--seo",children:"Accessibility & SEO"}),"\n",(0,i.jsxs)(n.p,{children:["A lovely emergent property of using native elements for content like text, is that operating-system level accessibility measures (like screen readers) ",(0,i.jsx)(n.em,{children:"just work"})," out of the box."]}),"\n",(0,i.jsxs)(n.p,{children:["For example, if you right-click + inspect a text element in Pax Web, you'll see that it is rendered into the DOM as a ",(0,i.jsx)(n.code,{children:"<span>Your text here</span>"}),", as opposed to rasterized in a canvas.  Screen readers read this content natively."]}),"\n",(0,i.jsxs)(n.p,{children:["SEO, or ",(0,i.jsx)(n.em,{children:"search engine optimization"})," a.k.a. Google / DuckDuckGo compatibility, is also thus solved, allowing crawlers to access text content exactly as they would in any plain ol' Web page or application."]}),"\n",(0,i.jsx)(n.h3,{id:"footprint",children:"Footprint"}),"\n",(0,i.jsxs)(n.p,{children:["Worth noting about this approach is that it ",(0,i.jsx)(n.em,{children:"significantly reduces"})," the footprint burden of the Pax runtime.  This hybrid native-canvas/native-elements approach allows Pax to render without needing to bundle a fully featured rendering engine like Skia, which would add megabytes to base footprints."]}),"\n",(0,i.jsxs)(n.p,{children:["For reference, this footprint burden is one of the challenges faced by many cross-platform renderers like Flutter —\xa0commonly, such tools require bundling ",(0,i.jsx)(n.a,{href:"https://skia.googlesource.com/skia",children:"Skia"})," and downloading megabytes of data in order to load a single page in a browser."]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.a,{href:"../intro-priorities-and-prior-art",children:"Pax aims"})," to keep its base footprint <100kB."]}),"\n"]})}let d={MDXContent:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{wrapper:n}=Object.assign({},(0,o.a)(),e.components);return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(_createMdxContent,{...e})}):_createMdxContent(e)},pageOpts:{filePath:"pages/reference/native-rendering.md",route:"/reference/native-rendering",pageMap:[{kind:"Meta",data:{index:"Introduction","intro-priorities-and-prior-art":"Priorities and Prior Art",installation:"Installation","key-concepts":"Key Concepts",examples:"Examples",reference:"Reference","authors-contributors":"Contributors",contact:{title:"Contact ↗",type:"page",href:"https://x.com/DevelopingPax",newWindow:!0}}},{kind:"MdxPage",name:"authors-contributors",route:"/authors-contributors"},{kind:"MdxPage",name:"examples",route:"/examples"},{kind:"MdxPage",name:"index",route:"/"},{kind:"Folder",name:"installation",route:"/installation",children:[{kind:"Meta",data:{"operating-systems":"Operating Systems","app-targets":"Application Targets",plugins:"Plugins"}},{kind:"Folder",name:"app-targets",route:"/installation/app-targets",children:[{kind:"Meta",data:{web:"Web",desktop:"Desktop (MacOS)",mobile:"Mobile (iOS)"}},{kind:"MdxPage",name:"desktop",route:"/installation/app-targets/desktop"},{kind:"MdxPage",name:"mobile",route:"/installation/app-targets/mobile"},{kind:"MdxPage",name:"web",route:"/installation/app-targets/web"}]},{kind:"Folder",name:"operating-systems",route:"/installation/operating-systems",children:[{kind:"Meta",data:{macos:"MacOS",linux:"Linux",windows:"Windows"}},{kind:"MdxPage",name:"linux",route:"/installation/operating-systems/linux"},{kind:"MdxPage",name:"macos",route:"/installation/operating-systems/macos"},{kind:"MdxPage",name:"windows",route:"/installation/operating-systems/windows"}]},{kind:"MdxPage",name:"plugins",route:"/installation/plugins"}]},{kind:"MdxPage",name:"intro-priorities-and-prior-art",route:"/intro-priorities-and-prior-art"},{kind:"Folder",name:"key-concepts",route:"/key-concepts",children:[{kind:"Meta",data:{components:"Components",templates:"Templates",settings:"Settings",expressions:"Expressions",handlers:"Handlers",primitives:"Primitives"}},{kind:"MdxPage",name:"components",route:"/key-concepts/components"},{kind:"MdxPage",name:"expressions",route:"/key-concepts/expressions"},{kind:"MdxPage",name:"handlers",route:"/key-concepts/handlers"},{kind:"MdxPage",name:"primitives",route:"/key-concepts/primitives"},{kind:"MdxPage",name:"settings",route:"/key-concepts/settings"},{kind:"MdxPage",name:"templates",route:"/key-concepts/templates"}]},{kind:"Folder",name:"reference",route:"/reference",children:[{kind:"Meta",data:{designability:"Designability",layout:"Layout & Transforms","pax-std":"Pax Std",paxel:"Paxel","compilation-model":"Compilation Model",macros:"Macros","hardware-component-model":"Hardware Component Model","native-rendering":"Native Rendering",grammar:"DSL Grammar",javascript:"Pax & Javascript"}},{kind:"MdxPage",name:"compilation-model",route:"/reference/compilation-model"},{kind:"MdxPage",name:"designability",route:"/reference/designability"},{kind:"MdxPage",name:"grammar",route:"/reference/grammar"},{kind:"MdxPage",name:"hardware-component-model",route:"/reference/hardware-component-model"},{kind:"MdxPage",name:"javascript",route:"/reference/javascript"},{kind:"MdxPage",name:"layout",route:"/reference/layout"},{kind:"MdxPage",name:"macros",route:"/reference/macros"},{kind:"MdxPage",name:"native-rendering",route:"/reference/native-rendering"},{kind:"MdxPage",name:"pax-std",route:"/reference/pax-std"},{kind:"MdxPage",name:"paxel",route:"/reference/paxel"}]}],flexsearch:{codeblocks:!0},title:"Native Rendering",headings:c},pageNextRoute:"/reference/native-rendering",nextraLayout:s.ZP,themeConfig:r.Z};n.default=(0,t.j)(d)},8426:function(e,n,a){"use strict";var i=a(5893),t=a(5379),s=a.n(t);a(7294);let r={logo:e=>{let{darkMode:n}=e;return(0,i.jsxs)("svg",{height:"30",viewBox:"0 0 297 150",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:"jsx-37c7cf7a4c4dcf24",children:[(0,i.jsxs)("g",{clipPath:"url(#clip0_100_305)",className:"jsx-37c7cf7a4c4dcf24",children:[(0,i.jsx)("path",{d:"M62.8831 75.0046C72.2158 75.0046 80.687 66.4399 80.687 57.0042C80.687 47.5686 72.2158 39.0039 62.8831 39.0039C53.5504 39.0039 45.0792 47.5686 45.0792 57.0042C45.0792 66.4399 53.5504 75.0046 62.8831 75.0046Z",fill:"currentColor",className:"jsx-37c7cf7a4c4dcf24"}),(0,i.jsx)("path",{d:"M0 8.42178V139.807L22.8643 149.814V149.737L22.8562 149.743V97.5579V53.8939L22.8643 15.7005L45.6553 7.85025L22.8643 0L0 8.42178Z",fill:"currentColor",className:"jsx-37c7cf7a4c4dcf24"}),(0,i.jsx)("path",{d:"M262.765 7.85022H45.6526V25.6033C45.6037 25.6445 45.5547 25.6829 45.5085 25.7242C50.6994 21.3306 57.4802 18.624 63.5652 18.624C79.8119 18.624 96.1889 33.0936 99.1187 51.2533C101.915 32.7336 118.553 18.5031 137.599 18.5031C143.817 18.5031 149.739 20.9733 154.862 24.9933V18.5031H176.468V95.4999H154.862V88.5316C150.378 92.7109 143.817 95.0218 137.599 95.0218C118.667 95.0218 102.116 80.9644 99.1676 62.6124C96.4879 80.7089 81.0511 94.5904 62.4047 94.5904C56.3795 94.5904 50.3733 92.5323 45.6499 88.3256V105.342H262.762L296.997 56.6938L262.762 7.85022H262.765ZM254.872 95.1866H230.168L216.09 74.3314L200.835 95.1866H176.523L203.969 57.0839L177.428 18.3383H201.925L216.397 39.504L230.244 18.3383H254.872L228.374 57.0839L254.872 95.1866Z",fill:"currentColor",className:"jsx-37c7cf7a4c4dcf24"}),(0,i.jsx)("path",{d:"M155.389 56.7653C155.389 47.1262 146.755 38.3967 137.221 38.3967C127.688 38.3967 119.053 47.1262 119.053 56.7653C119.053 66.4043 127.688 75.1338 137.221 75.1338C146.755 75.1338 155.389 66.4043 155.389 56.7653Z",fill:"currentColor",className:"jsx-37c7cf7a4c4dcf24"})]}),(0,i.jsx)("defs",{className:"jsx-37c7cf7a4c4dcf24",children:(0,i.jsx)("clipPath",{id:"clip0_100_305",className:"jsx-37c7cf7a4c4dcf24",children:(0,i.jsx)("rect",{width:"297",height:"149.814",fill:"white",className:"jsx-37c7cf7a4c4dcf24"})})}),(0,i.jsx)(s(),{id:"37c7cf7a4c4dcf24",children:"svg.jsx-37c7cf7a4c4dcf24{-webkit-mask-image:-webkit-linear-gradient(30deg,black 25%,rgba(0,0,0,.2)50%,black 75%);mask-image:-webkit-linear-gradient(30deg,black 25%,rgba(0,0,0,.2)50%,black 75%);mask-image:-moz-linear-gradient(30deg,black 25%,rgba(0,0,0,.2)50%,black 75%);mask-image:-o-linear-gradient(30deg,black 25%,rgba(0,0,0,.2)50%,black 75%);mask-image:linear-gradient(60deg,black 25%,rgba(0,0,0,.2)50%,black 75%);-webkit-mask-size:400%;mask-size:400%;-webkit-mask-position:0%;mask-position:0%}svg.jsx-37c7cf7a4c4dcf24:hover{-webkit-mask-position:100%;mask-position:100%;-webkit-transition:mask-position 1s ease,-webkit-mask-position 1s ease;-moz-transition:mask-position 1s ease,-webkit-mask-position 1s ease;-o-transition:mask-position 1s ease,-webkit-mask-position 1s ease;transition:mask-position 1s ease,-webkit-mask-position 1s ease}"})]})},project:{link:"https://github.com/paxengine/pax"},chat:{link:"https://discord.com"},docsRepositoryBase:"https://github.com/paxengine/docs",footer:{text:"Pax Corp Inc."},useNextSeoProps:()=>({titleTemplate:"%s"}),head:(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("meta",{name:"viewport",content:"width=device-width, initial-scale=1.0"}),(0,i.jsx)("meta",{property:"og:title",content:"Pax Docs"}),(0,i.jsx)("meta",{property:"og:description",content:"Documentation for Pax"}),(0,i.jsx)("link",{rel:"icon",href:"./favicon.svg",type:"image/svg+xml"})]})};n.Z=r},5789:function(){}},function(e){e.O(0,[774,678,888,179],function(){return e(e.s=7875)}),_N_E=e.O()}]);